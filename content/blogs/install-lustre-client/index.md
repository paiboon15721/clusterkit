---
title: 'ติดตั้ง lustre client โดยไม่ต้องเปลี่ยนไปใช้ lustre kernel'
date: 2010-02-15T16:21:00+07:00
draft: false
---
Kernel ถ้าไม่จำเป็นก็คงไม่มีใครอยากยุ่งกับมัน สำหรับผู้ใช้ lustre file system มาแต่แรก ๆ อาจจะเคยชินกับการลง lustre kernel และในบางครั้งเจ้าเคอร์เนลก็สร้างปัญหาให้กับไดร์ฟเวอร์กับฮาร์ดแวร์อื่น ๆ บางตัว บางท่านอาจจะยังไม่รู้ว่า ท่านสามารถลง lustre client โดยไม่ต้องเปลี่ยนไปใช้ lustre kernel ได้แล้ว

ปัจจุบัน lustre ได้เตรียม แพ็กเกจชนิดที่ไม่ต้อง patch kernel ไว้ ในชื่อว่า lustre-client และ lustre-client-modules เพียงแค่ติดตั้ง 2 แพ็กเกจดังกล่าวโดยเลือกให้ตรงกับ kernel ของลีนุกซ์ที่ใช้อยู่ในปัจจุบัน จากนั้นสั่ง depmod -a; modprobe lustre ถ้าไม่มี error อะไรแสดงขึ้นมาก็เป็นอันว่าใช้ได้แล้วครับ ลองสั่ง mount ดูได้เลยครับ แต่ถ้าแพ็คเกจ lustre ที่ดาวน์โหลดมามีเวอร์ชั่นของเคอร์เนลไม่ตรงกับที่อยู่ในปัจจุบันละก็ ต้อง manual กันอีกนิดหน่อยครับ

ยกตัวอย่างเช่นผมดาวน์โหลด แพ็คเกจต่อไปนี้มา

- lustre-client-1.8.2-2.6.18_164.11.1.el5_lustre.1.8.2.x86_64.rpm
- lustre-client-modules-1.8.2-2.6.18_164.11.1.el5_lustre.1.8.2.x86_64.rpm

ทั้งคู่เป็นแพ็คเกจของ lustre เวอร์ชั่น 1.8.2 ที่ทำมาสำหรับเคอร์เนลเวอร์ชั่น 2.6.18-164.11.1.el5 แต่ที่นี่ผมใช้ CentOS5.4 มีรุ่นของเคอร์เนลเป็น 2.6.18-164.el5 ซึ่งเป็นไม่ตรงกัน เพราะของทาง lustre มีหมวดย่อยมาอีก แบบนี้ทำให้ kernel ที่อัพเดทแยกกันอยู่ วิธีการที่ต้องทำก็คือ ย้ายไฟล์ kernel ที่ติดตั้งจากแพ็คเกจ lustre สองแพ็คเกจข้างต้น ไปไว้ยังตำแหน่ง kernel ที่ใช้อยู่ในปัจจุบัน หากท่านเข้าไปที่ดูที่ /lib/modules/2.6.18-164.11.1.el5/kernel/ จะพบสองไดเรกทอรี่ที่สำคัญคือ fs กับ net นั่นคือไดร์ฟเวอร์สำหรับ file system และ network นั่นเอง ซึ่งเป็นส่วนสำคัญของ lustre file system
ท่านจำเป็นต้องคัดลอกหรือย้าย ไดเรกทอรี่ดังต่อไปนี้

    /lib/modules/2.6.18-164.11.1.el5/kernel/fs/lustre
    /lib/modules/2.6.18-164.11.1.el5/kernel/net/lustre
ไปไว้ยังตำแหน่งของเคอร์เนลปัจจุบัน คือ /lib/modules/2.6.18-164.el5/kernel/fs และ /lib/modules/2.6.18-164.el5/kernel/net 

ตามลำดับจากนั้นก็สั่ง depmod - a; modprobe lustre แล้วก็ทดลอง mount ดูได้เลยครับ

ด้วยวิธีการนี้ทำให้ท่านไม่ต้องเปลี่ยนไปใช้ kernel ที่เป็น lustre ก็ช่วยแก้ไขปัญหาเรื่องการใช้งานร่วมกับฮาร์ดแวร์อื่นที่บ้างครั้งต้องติดตั้งไดร์เวอร์ที่มาอัพเกรดเคอร์เนลได้เป็นอย่างดีครับ